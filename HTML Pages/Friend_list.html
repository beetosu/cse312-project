<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Friend's List</title>
    <link rel="stylesheet" href="FriendList.css">
</head>
<body>

<div id="notification"></div>

<div class="container">

    <div class="title" style="color: #0e4bf1; text-align: center; font-size: 38px">Welcome Back User!
        <label>
            <input type="button" value="Online" style="width: 60px; height: 30px; border-radius: 6px; background-color: MediumSeaGreen" id="online" >
        </label>
    </div>

    <hr>

    <section class="contacts-library">
        <ul class="contacts-list">
                <div class="contact-section">
                    <li class="list__item">
                        <p class="contact-name">Jack</p>
                        <p class="Login">Online</p>
                    </li>
                </div>

            <hr>

                <div class="contact-section">
                    <li class="list__item">
                        <p class="contact-name">Jacky</p>
                        <p class="Login">Online</p>
                    </li>
                </div>

            <hr>

                <div class="contact-section">
                    <li class="list__item">
                        <p class="contact-name">Daniel</p>
                        <p class="Logout">Offline</p>
                    </li>
                </div>

            <hr>

                <div class="contact-section">
                    <li class="list__item" id="Jennie">
                        <p class="contact-name">Jennie</p>
                        <p class="Logout">Offline</p>
                    </li>
                </div>

            <hr>

                <div class="contact-section">
                    <li class="list__item">
                        <p class="contact-name">Smith
                        <p class="Logout">Offline</p>
                    </li>
                </div>


        </ul>
    </section>
</div>

<script>
    //Online_Offline status feature
    const statusSocket = new WebSocket('ws://' + "localhost:8001" + '/onlinelist');

    // User status websocket(online/offline)
    // Call the addUserStatus function whenever status is received from the server over the WebSocket
    statusSocket.onmessage = addUserStatus;

    const btn = document.getElementById("online");
    btn.addEventListener("click", ()=>{
        if(btn.value === "Online"){
            btn.style.backgroundColor = "Tomato";
            btn.value = "Offline";
            sendUserStatus()
        }else{
            btn.style.backgroundColor = "MediumSeaGreen";
            btn.value = "Online";
            sendUserStatus()
        }
    })

    // Read the name/status the user is sending it to the server over the WebSocket as a JSON string
    function sendUserStatus() {
        const userName = "{{username}}"; //How do we get the username from?
        const userStatus = btn.value;
        btn.focus();
        if(userStatus !== "") {
            statusSocket.send(JSON.stringify({'username': userName, 'status': userStatus}));
        }
    }

    // Called when the server sends a new message over the WebSocket
    function addUserStatus() {
        if(btn.value === "Online") {
            alert("{{username}} had been logged in")
        }else {
            alert("{{username}} had been logged out")
        }
    }


    //Notification feature
    const notificationSocket = new WebSocket('ws://' + "localhost:8001" + '/{{username}}');

    // Notification Websocket
    notificationSocket.onmessage = notificationMessage;

    // Sends an alert to user when received a message
    function notificationMessage() {
        alert("{{username}} sends you a message!")
    }
</script>

</body>
</html>